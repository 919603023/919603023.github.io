<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.24">
    <title>WGB的小破站</title><meta name="description" content="分享技术，开源万岁">
    <link rel="preload" href="/assets/js/runtime~app.fa156efa.js" as="script"><link rel="preload" href="/assets/css/styles.9f21223e.css" as="style"><link rel="preload" href="/assets/js/1773.b136e78e.js" as="script"><link rel="preload" href="/assets/js/app.7a04ff8e.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.9f21223e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="https://vuejs.org/images/logo.png" alt="WGB的小破站"><span class="site-name can-hide">WGB的小破站</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/contents" class="nav-link" aria-label="目录"><!--[--><!--]--> 目录 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="前端技术"><span class="title">前端技术</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="前端技术"><span class="title">前端技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/front/html" class="nav-link" aria-label="HTML"><!--[--><!--]--> HTML <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/front/css" class="nav-link" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/front/javascript" class="nav-link" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/front/vue" class="nav-link" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="后端技术"><span class="title">后端技术</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="后端技术"><span class="title">后端技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/back/golang" class="nav-link" aria-label="Golang"><!--[--><!--]--> Golang <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/back/java" class="nav-link" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/back/python" class="nav-link" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/back/rust" class="nav-link" aria-label="Rust"><!--[--><!--]--> Rust <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="区块链技术"><span class="title">区块链技术</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="区块链技术"><span class="title">区块链技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/blockchain/Starcoin" class="nav-link" aria-label="Starcoin"><!--[--><!--]--> Starcoin <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blockchain/DF" class="nav-link" aria-label="Dark Forest"><!--[--><!--]--> Dark Forest <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/other/regex" class="nav-link" aria-label="正则表达式"><!--[--><!--]--> 正则表达式 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/git" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/linux" class="nav-link" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/docker" class="nav-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/environment" class="nav-link" aria-label="环境设置"><!--[--><!--]--> 环境设置 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/miner" class="nav-link" aria-label="挖矿"><!--[--><!--]--> 挖矿 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/contents" class="nav-link" aria-label="目录"><!--[--><!--]--> 目录 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="前端技术"><span class="title">前端技术</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="前端技术"><span class="title">前端技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/front/html" class="nav-link" aria-label="HTML"><!--[--><!--]--> HTML <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/front/css" class="nav-link" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/front/javascript" class="nav-link" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/front/vue" class="nav-link" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="后端技术"><span class="title">后端技术</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="后端技术"><span class="title">后端技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/back/golang" class="nav-link" aria-label="Golang"><!--[--><!--]--> Golang <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/back/java" class="nav-link" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/back/python" class="nav-link" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/back/rust" class="nav-link" aria-label="Rust"><!--[--><!--]--> Rust <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="区块链技术"><span class="title">区块链技术</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="区块链技术"><span class="title">区块链技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/blockchain/Starcoin" class="nav-link" aria-label="Starcoin"><!--[--><!--]--> Starcoin <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blockchain/DF" class="nav-link" aria-label="Dark Forest"><!--[--><!--]--> Dark Forest <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/other/regex" class="nav-link" aria-label="正则表达式"><!--[--><!--]--> 正则表达式 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/git" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/linux" class="nav-link" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/docker" class="nav-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/environment" class="nav-link" aria-label="环境设置"><!--[--><!--]--> 环境设置 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/miner" class="nav-link" aria-label="挖矿"><!--[--><!--]--> 挖矿 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item"></p><ul class=""><li><!--[--><a aria-current="page" href="/blockchain/StarCoin/_blog/Starcoin%E4%B8%8EDapp/Starcoin%E4%B8%8EDapp.html#一、dapp-的-产生背景" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="一、Dapp 的 产生背景"><!--[--><!--]--> 一、Dapp 的 产生背景 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blockchain/StarCoin/_blog/Starcoin%E4%B8%8EDapp/Starcoin%E4%B8%8EDapp.html#二、-dapp-开发" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="二、 Dapp 开发"><!--[--><!--]--> 二、 Dapp 开发 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/blockchain/StarCoin/_blog/Starcoin%E4%B8%8EDapp/Starcoin%E4%B8%8EDapp.html#_1-开发前端界面前的准备" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1. 开发前端界面前的准备"><!--[--><!--]--> 1. 开发前端界面前的准备 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blockchain/StarCoin/_blog/Starcoin%E4%B8%8EDapp/Starcoin%E4%B8%8EDapp.html#_2-starmask" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="2. StarMask"><!--[--><!--]--> 2. StarMask <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blockchain/StarCoin/_blog/Starcoin%E4%B8%8EDapp/Starcoin%E4%B8%8EDapp.html#_3-官方的示例starmask-test-dapp" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="3. 官方的示例Starmask-test-dapp"><!--[--><!--]--> 3. 官方的示例Starmask-test-dapp <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blockchain/StarCoin/_blog/Starcoin%E4%B8%8EDapp/Starcoin%E4%B8%8EDapp.html#_4-starmask-test-dapp-分析" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="4. Starmask-test-dapp 分析"><!--[--><!--]--> 4. Starmask-test-dapp 分析 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/blockchain/StarCoin/_blog/Starcoin%E4%B8%8EDapp/Starcoin%E4%B8%8EDapp.html#三、开发常用的工具-postman" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="三、开发常用的工具--Postman"><!--[--><!--]--> 三、开发常用的工具--Postman <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/blockchain/StarCoin/_blog/Starcoin%E4%B8%8EDapp/Starcoin%E4%B8%8EDapp.html#_1-fork-collection" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1. Fork collection"><!--[--><!--]--> 1. Fork collection <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blockchain/StarCoin/_blog/Starcoin%E4%B8%8EDapp/Starcoin%E4%B8%8EDapp.html#_2-添加-enviroment-json文件" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="2. 添加 Enviroment Json文件"><!--[--><!--]--> 2. 添加 Enviroment Json文件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blockchain/StarCoin/_blog/Starcoin%E4%B8%8EDapp/Starcoin%E4%B8%8EDapp.html#_3-调用api" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="3. 调用API"><!--[--><!--]--> 3. 调用API <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><p>#Starcoin &amp; Dapp实战</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>* 本文由Starcoin社区原创 作者:WGB
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="一、dapp-的-产生背景" tabindex="-1"><a class="header-anchor" href="#一、dapp-的-产生背景" aria-hidden="true">#</a> 一、Dapp 的 产生背景</h2><p>  随着计算机技术和互联网技术的不断发展，人们从最开始的大哥大到传呼机，从传呼机到手机，再到如今的智能穿戴设备等，人们一直在探索便携的交互体验。但随着科技的进步，人们也需求更多的功能，于是，手机的功能从最开始的通信设备变到如今的多媒体娱乐通信办公等多功能的设备，这些功能都是由App提供的，各个软件公司推出自己的App来提供服务，我们也体验到了科技进步带来的便捷，但是由于各个公司推出的App都是中心化的服务，这也就导致了如果软件公司由于各种各样的原因不去运行App的服务器，也不维护App，就会导致这个App被废弃，存储在其中的信息资料也随着公司的服务器的关闭而永久消失，如果是这些信息是游戏数据，那么你辛辛苦苦奋战的日日夜夜的游戏装备，游戏等级都将成为<code>&quot;时代的眼泪&quot;</code>。<br>   但是当区块链技术发展到今天，我们可以利用区块链不可篡改，永久保留的特性对App进行升级为Dapp(Decentralized application )，以去中心化的方式创造并运行它，就算这条区块链被人遗忘，你同样可以通过运行一个节点的方式继续拥有你的数据。通过这篇文章希望大家了解如何通过Move语言在Starcoin链上使用和开发一个Dapp。</p><h2 id="二、-dapp-开发" tabindex="-1"><a class="header-anchor" href="#二、-dapp-开发" aria-hidden="true">#</a> 二、 Dapp 开发</h2><p>  Dapp 从结构上可以分为前端和后端，Dapp的前端与传统app的前端类似，但Dapp的后端是区块链，这和传统的后端不同，传统方式是前端→API→数据库，Dapp是前端→智能合约→区块链，所以Dapp的开发主要是前端界面的交互，本文主要以官方示例的Starmask-test-dapp 作为示例。</p><h3 id="_1-开发前端界面前的准备" tabindex="-1"><a class="header-anchor" href="#_1-开发前端界面前的准备" aria-hidden="true">#</a> 1. 开发前端界面前的准备</h3><h4 id="_1-chrome-多账号分离开发环境" tabindex="-1"><a class="header-anchor" href="#_1-chrome-多账号分离开发环境" aria-hidden="true">#</a> (1) Chrome 多账号分离开发环境</h4><blockquote><p>对于需要多个测试账号的开发环境来说，Chrome的多账户功能可以方便的创建多账号的环境。</p></blockquote><p><img src="/assets/img/Chrome多账户.9f65f28d.png" alt="Chrome多账户"></p><h4 id="_2-安装starmask" tabindex="-1"><a class="header-anchor" href="#_2-安装starmask" aria-hidden="true">#</a> (2) 安装StarMask</h4><blockquote><p>在新身份的Chrome中通过下载zip包后解压安装或Chrome商店安装的方式安装StarMask,详细的安装使用过程可以查看<a href="https://github.com/starcoinorg/starmask-extension/blob/main/docs/how-to-install.md" target="_blank" rel="noopener noreferrer">官方文档<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>进行安装</p></blockquote><p><strong><a href="https://chrome.google.com/webstore/detail/empty-title/mfhbebgoclkghebffdldpobeajmbecfk?hl=zh-CN" target="_blank" rel="noopener noreferrer">Chrome商店安装<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>:</strong></p><p><img src="/assets/img/Chrome商店安装.a90d2725.png" alt="Chrome商店安装"></p><p><strong><a href="https://github.com/starcoinorg/starmask-extension/releases" target="_blank" rel="noopener noreferrer">解压方式安装<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>:</strong></p><p><img src="/assets/img/解压方式安装.a6a7f0c8.png" alt="解压方式安装"></p><h4 id="_3-创建新的账户" tabindex="-1"><a class="header-anchor" href="#_3-创建新的账户" aria-hidden="true">#</a> (3) 创建新的账户</h4><blockquote><p>在安装StarMask后新建或导入账户后，就可以使用新的账户进行开发调试。</p></blockquote><p><img src="/assets/img/成功创建账户.7fc35280.png" alt="成功创建账户"></p><h3 id="_2-starmask" tabindex="-1"><a class="header-anchor" href="#_2-starmask" aria-hidden="true">#</a> 2. StarMask</h3><blockquote><p>  Dapp的使用与区块链密不可分，但由于与区块链的交互需要使用私钥进行签名等操作，所以大多的Dapp不会直接获取用户的私钥，而是通过一个&quot;中间件&quot;插件钱包，来管理用户的秘钥，使Dapp不会直接获取用户的秘钥信息，当用户需要与区块链进行交互时，通过钱包插件向用户发起确认请求，用户做出响应操作后，插件会把签名好的交易信息发送区块链上进行交互或将拒绝信息返回Dapp。<br>   Starcoin 使用的StarMask正是官方推出的插件钱包，它可以帮助我们安全的保存、使用自己的资产。<br>   StarMask 与MetaMask的整体架构类似，并且和web3 类似的提供了一个全局的变量，以便JavaScript SDK可以方便的与钱包插件进行交互。</p></blockquote><p><strong>MetaMask架构图：</strong><br><img src="/assets/img/MetaMask架构图.7cfde3b8.png" alt="MetaMask架构图"></p><p><strong>Starcoin全局变量：</strong><br><img src="/assets/img/Starcoin全局变量.62e8f167.png" alt="Starcoin全局变量"></p><h4 id="_1-starmask-的依赖库" tabindex="-1"><a class="header-anchor" href="#_1-starmask-的依赖库" aria-hidden="true">#</a> (1) StarMask 的依赖库</h4><blockquote><p>  StarMask是官方开发并且开源的钱包插件，它是使用JavaScript编写的，下图是StarMask所依赖的库。</p></blockquote><p><img src="/assets/img/StarMask依赖库.76a30a47.png" alt="StarMask依赖库"></p><h3 id="_3-官方的示例starmask-test-dapp" tabindex="-1"><a class="header-anchor" href="#_3-官方的示例starmask-test-dapp" aria-hidden="true">#</a> 3. 官方的示例Starmask-test-dapp</h3><blockquote><p>  Starcoin 和以太坊一样，也提供了一个JavaScript SDK ，可以通过SDK进行前端网页的开发，官方也提供了一个Dapp的示例，可以上面测试钱包的链接、发送STC、调用合约、铸造示例NFT，签名验证等等，功能上基本涵盖了常用的功能，源码也在Github上开源，我们开发Dapp时可以以此为基础进行开发。</p></blockquote><p><strong><a href="https://starmask-test-dapp.starcoin.org/" target="_blank" rel="noopener noreferrer">官方示例Dapp<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>:</strong></p><p>体验入口：https://starmask-test-dapp.starcoin.org/<br> GitHub仓库地址：https://github.com/starcoinorg/starmask-test-dapp</p><p><img src="/assets/img/Dapp-test.9728ff6f.png" alt="Dapp-test"></p><h3 id="_4-starmask-test-dapp-分析" tabindex="-1"><a class="header-anchor" href="#_4-starmask-test-dapp-分析" aria-hidden="true">#</a> 4. Starmask-test-dapp 分析</h3><blockquote><p>  我们在开发时可以对Starmask-test-dapp进行功能和流程分析，从中学到Dapp开发的流程和代码库的使用，整体的开发流程和代码库与以太坊上的开发类似，如果有以太坊上开发的经验，可以很轻松的转移到Starcoin上来。</p></blockquote><h4 id="_1-starmask-test-dapp-依赖库" tabindex="-1"><a class="header-anchor" href="#_1-starmask-test-dapp-依赖库" aria-hidden="true">#</a> (1) Starmask-test-dapp 依赖库</h4><blockquote><p>Starmask-test-dapp 主要依赖有starmask-onboarding、starmask-forwarder和starcoin.js。</p><ul><li>starmask-onboarding:用来检测是否安装StarMask，如果未安装，可以点击按钮进行安装跳转，如果已经安装则可以显示为<code>&quot;点击连接钱包&quot;</code></li><li>starcoin.js:用来和区块链交互、格式转换等的工具库，是开发Dapp主要使用的SDK。</li></ul></blockquote><p><img src="/assets/img/test-dapp.e4e9bb6b.png" alt="test-dapp"></p><h4 id="_2-简要功能分析" tabindex="-1"><a class="header-anchor" href="#_2-简要功能分析" aria-hidden="true">#</a> (2) 简要功能分析</h4><blockquote><p>在Starmask-test-dapp上主要的操作有连接钱包、获取链信息，获取账号，请求权限、签名与验证、发送交易、部署和调用合约。</p></blockquote><ul><li>连接钱包:用来将Dapp连接到StarMask的操作，使Dapp可以执行后续的操作，这也是使用Dapp的第一步</li><li>获取链信息:用来查看当前的链是主网还是测试网或者是本地网络</li><li>获取账号:用来获取已经连接的账号</li><li>请求权限:当连接钱包后，StarMask中有多个账号时，通过请求权限功能进行切换</li><li>签名与验证:用来签名一段信息，并可以验证信息的签名者</li><li>发送交易:一般用来发送STC</li><li>部署合约:可以通过二进制的方式部署合约，不需要同步主网或测试网</li><li>调用合约:在Dapp上调用合约，这是主要的Dapp与区块链的交互方式</li></ul><h4 id="_3-简要功能代码分析" tabindex="-1"><a class="header-anchor" href="#_3-简要功能代码分析" aria-hidden="true">#</a> (3) 简要功能代码分析</h4><h5 id="_1-链接钱包" tabindex="-1"><a class="header-anchor" href="#_1-链接钱包" aria-hidden="true">#</a> 1) 链接钱包</h5><blockquote><p>在 Starmask-test-dapp 中通过以下代码链接StarMask钱包，通过全局的 starcoin 变量调用 stc_requestAccounts 方法进行连接</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">onClickConnect</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> newAccounts <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>starcoin<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        method<span class="token operator">:</span> <span class="token string">&#39;stc_requestAccounts&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token function">handleNewAccounts</span><span class="token punctuation">(</span>newAccounts<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="_2-获取链信息" tabindex="-1"><a class="header-anchor" href="#_2-获取链信息" aria-hidden="true">#</a> 2) 获取链信息</h5><blockquote><p>在 Starmask-test-dapp 中通过以下代码获取链信息， 通过全局的 starcoin 变量调用 chain.id 方法进行获取</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getNetworkAndChainId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> chainInfo <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>starcoin<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        method<span class="token operator">:</span> <span class="token string">&#39;chain.id&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">handleNewChain</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chainInfo<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token function">handleNewNetwork</span><span class="token punctuation">(</span>chainInfo<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="_3-获取账号" tabindex="-1"><a class="header-anchor" href="#_3-获取账号" aria-hidden="true">#</a> 3) 获取账号</h5><blockquote><p>在 Starmask-test-dapp 中通过以下代码获取账号， 通过全局的 starcoin 变量调用 stc_accounts 方法进行获取</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> getAccountsButton<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> _accounts <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>starcoin<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          method<span class="token operator">:</span> <span class="token string">&#39;stc_accounts&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        getAccountsResults<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">&#39;Not able to get accounts&#39;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        getAccountsResults<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="_4-请求权限" tabindex="-1"><a class="header-anchor" href="#_4-请求权限" aria-hidden="true">#</a> 4) 请求权限</h5><blockquote><p>在 Starmask-test-dapp 中通过以下代码请求权限， 通过全局的 starcoin 变量调用 wallet_requestPermissions 方法进行请求</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> permissionsArray <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>starcoin<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          method<span class="token operator">:</span> <span class="token string">&#39;wallet_requestPermissions&#39;</span><span class="token punctuation">,</span>
          params<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> stc_accounts<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="_5-签名与验证" tabindex="-1"><a class="header-anchor" href="#_5-签名与验证" aria-hidden="true">#</a> 5) 签名与验证</h5><blockquote><p>在 Starmask-test-dapp 中通过以下代码签名和验证， 通过全局的 starcoin 变量调用 personal_sign 方法进行签名，使用starcoin.js中的工具函数进行验证签名地址</p></blockquote><p><strong>签名:</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>exampleMessage<span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&#39;hex&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> msg <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> networkId <span class="token operator">=</span> networkDiv<span class="token punctuation">.</span>innerHTML
        <span class="token keyword">const</span> extraParams <span class="token operator">=</span> <span class="token punctuation">{</span> networkId <span class="token punctuation">}</span>
        <span class="token keyword">const</span> sign <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>starcoin<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          method<span class="token operator">:</span> <span class="token string">&#39;personal_sign&#39;</span><span class="token punctuation">,</span>
          <span class="token comment">// params: [msg, from, &#39;Example password&#39;],</span>
          <span class="token comment">// extraParams = params[2] || {}; means it should be an object:</span>
          <span class="token comment">// params: [msg, from, { pwd: &#39;Example password&#39; }],</span>
          params<span class="token operator">:</span> <span class="token punctuation">[</span>msg<span class="token punctuation">,</span> from<span class="token punctuation">,</span> extraParams<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>验证:</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> from <span class="token operator">=</span> accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> sign <span class="token operator">=</span> personalSignResult<span class="token punctuation">.</span>innerHTML
<span class="token keyword">const</span> recoveredAddr <span class="token operator">=</span> <span class="token keyword">await</span> utils<span class="token punctuation">.</span>signedMessage<span class="token punctuation">.</span><span class="token function">recoverSignedMessageAddress</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> recoveredAddr <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="_6-发送交易" tabindex="-1"><a class="header-anchor" href="#_6-发送交易" aria-hidden="true">#</a> 6) 发送交易</h5><blockquote><p>在Starmask-test-dapp 中通过以下代码发送交易，通过获取交易金额、收款人信息进行组包后，发送交易</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token keyword">const</span> sendAmount <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;amountInput&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>sendAmount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// eslint-disable-next-line no-alert</span>
        window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Invalid sendAmount: should be a number!&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> <span class="token constant">BIG_NUMBER_NANO_STC_MULTIPLIER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigNumber</span><span class="token punctuation">(</span><span class="token string">&#39;1000000000&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> sendAmountSTC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigNumber</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;amountInput&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> sendAmountNanoSTC <span class="token operator">=</span> sendAmountSTC<span class="token punctuation">.</span><span class="token function">times</span><span class="token punctuation">(</span><span class="token constant">BIG_NUMBER_NANO_STC_MULTIPLIER</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> sendAmountHex <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sendAmountNanoSTC<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sendAmountHex<span class="token punctuation">,</span> sendAmountNanoSTC<span class="token operator">:</span> sendAmountNanoSTC<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> txParams <span class="token operator">=</span> <span class="token punctuation">{</span>
        to<span class="token operator">:</span> toAccount<span class="token punctuation">,</span>
        value<span class="token operator">:</span> sendAmountHex<span class="token punctuation">,</span>
        gasLimit<span class="token operator">:</span> <span class="token number">127845</span><span class="token punctuation">,</span>
        gasPrice<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> expiredSecs <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;expiredSecsInput&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> expiredSecs <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>expiredSecs <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        txParams<span class="token punctuation">.</span>expiredSecs <span class="token operator">=</span> expiredSecs
      <span class="token punctuation">}</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> txParams <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> transactionHash <span class="token operator">=</span> <span class="token keyword">await</span> starcoinProvider<span class="token punctuation">.</span><span class="token function">getSigner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendUncheckedTransaction</span><span class="token punctuation">(</span>txParams<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h5 id="_7-部署合约" tabindex="-1"><a class="header-anchor" href="#_7-部署合约" aria-hidden="true">#</a> 7) 部署合约</h5><blockquote><p>在Starmask-test-dapp 中通过以下代码部署合约，首先应该在本地把合约编译为二进制包，然后输入到Starmask-test-dapp，再通过组包后发送交易，就可以部署合约</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> packageHex <span class="token operator">=</span> contractPayloadhex<span class="token punctuation">.</span>value
        <span class="token keyword">const</span> transactionPayloadHex <span class="token operator">=</span> encoding<span class="token punctuation">.</span><span class="token function">packageHexToTransactionPayloadHex</span><span class="token punctuation">(</span>packageHex<span class="token punctuation">)</span>
        transactionHash <span class="token operator">=</span> <span class="token keyword">await</span> starcoinProvider<span class="token punctuation">.</span><span class="token function">getSigner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendUncheckedTransaction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          data<span class="token operator">:</span> transactionPayloadHex<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="_8-调用合约" tabindex="-1"><a class="header-anchor" href="#_8-调用合约" aria-hidden="true">#</a> 8) 调用合约</h5><blockquote><p>在Starmask-test-dapp 中通过以下两种方式调用合约，不需要签名的合约可以通过Call来调用，需要签名的合约需要通过组包、发送交易的方式调用<br><strong>不需签名的合约:</strong></p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">starcoinProvider</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          function_id<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">::ABC::token_address</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          type_args<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          args<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>需要签名的合约:</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>   <span class="token keyword">const</span> <span class="token constant">BIG_NUMBER_NANO_STC_MULTIPLIER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigNumber</span><span class="token punctuation">(</span><span class="token string">&#39;1000000000&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> sendAmountSTC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigNumber</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;amountInput&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> sendAmountNanoSTC <span class="token operator">=</span> sendAmountSTC<span class="token punctuation">.</span><span class="token function">times</span><span class="token punctuation">(</span><span class="token constant">BIG_NUMBER_NANO_STC_MULTIPLIER</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> sendAmountHex <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sendAmountNanoSTC<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

        <span class="token comment">// Multiple BcsSerializers should be used in different closures, otherwise, the latter will be contaminated by the former.</span>
        <span class="token keyword">const</span> amountSCSHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> se <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">bcs<span class="token punctuation">.</span>BcsSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token comment">// eslint-disable-next-line no-undef</span>
          se<span class="token punctuation">.</span><span class="token function">serializeU128</span><span class="token punctuation">(</span><span class="token function">BigInt</span><span class="token punctuation">(</span>sendAmountNanoSTC<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token function">hexlify</span><span class="token punctuation">(</span>se<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sendAmountHex<span class="token punctuation">,</span> sendAmountNanoSTC<span class="token operator">:</span> sendAmountNanoSTC<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> amountSCSHex <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span>
          <span class="token function">arrayify</span><span class="token punctuation">(</span>toAccount<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">arrayify</span><span class="token punctuation">(</span>amountSCSHex<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>

        <span class="token keyword">const</span> scriptFunction <span class="token operator">=</span> utils<span class="token punctuation">.</span>tx<span class="token punctuation">.</span><span class="token function">encodeScriptFunction</span><span class="token punctuation">(</span>functionId<span class="token punctuation">,</span> tyArgs<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>scriptFunction<span class="token punctuation">)</span>

        <span class="token comment">// Multiple BcsSerializers should be used in different closures, otherwise, the latter will be contaminated by the former.</span>
        <span class="token keyword">const</span> payloadInHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> se <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">bcs<span class="token punctuation">.</span>BcsSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          scriptFunction<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>se<span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token function">hexlify</span><span class="token punctuation">(</span>se<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payloadInHex <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">const</span> txParams <span class="token operator">=</span> <span class="token punctuation">{</span>
          data<span class="token operator">:</span> payloadInHex<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> expiredSecs <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;expiredSecsInput&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> expiredSecs <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>expiredSecs <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          txParams<span class="token punctuation">.</span>expiredSecs <span class="token operator">=</span> expiredSecs
        <span class="token punctuation">}</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> txParams <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> transactionHash <span class="token operator">=</span> <span class="token keyword">await</span> starcoinProvider<span class="token punctuation">.</span><span class="token function">getSigner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendUncheckedTransaction</span><span class="token punctuation">(</span>txParams<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h2 id="三、开发常用的工具-postman" tabindex="-1"><a class="header-anchor" href="#三、开发常用的工具-postman" aria-hidden="true">#</a> 三、开发常用的工具--Postman</h2><blockquote><p>  做前后端交互时，我们通常需要进行调用合约的调试。Starcoin的合约调用调试以Postman为例，Fork collection 到自己的工作区后，再添加如Main、barnard、localhost等网络信息就可以方便的使用API与合约交互或调试。</p></blockquote><h3 id="_1-fork-collection" tabindex="-1"><a class="header-anchor" href="#_1-fork-collection" aria-hidden="true">#</a> 1. Fork collection</h3><p>在官网的 <a href="https://starcoin.org/zh/developer/rpc/postman_document/" target="_blank" rel="noopener noreferrer">Postman 使用指南<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 页面点击 <a href="https://god.gw.postman.com/run-collection/13565741-60ce2c25-25bc-44ff-be4e-a080910cd108?action=collection%2Ffork&amp;collection-url=entityId%3D13565741-60ce2c25-25bc-44ff-be4e-a080910cd108%26entityType%3Dcollection%26workspaceId%3D921ce6e5-b414-4d15-89d9-0820c7c3d25a#?env%5Bstarcoin_main%5D=W3sia2V5IjoidXJsIiwidmFsdWUiOiJodHRwczovL21haW4tc2VlZC5zdGFyY29pbi5vcmciLCJlbmFibGVkIjp0cnVlfSx7ImtleSI6ImNoYWluX2lkIiwidmFsdWUiOiIxIiwiZW5hYmxlZCI6dHJ1ZX1d" target="_blank" rel="noopener noreferrer">Run in Postman<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 按钮，可以把Starcoin的 API 示例 fork 到你自己的工作区。<br><img src="/assets/img/官网的交互页面.f45f427b.png" alt="官网的交互页面"></p><h3 id="_2-添加-enviroment-json文件" tabindex="-1"><a class="header-anchor" href="#_2-添加-enviroment-json文件" aria-hidden="true">#</a> 2. 添加 Enviroment Json文件</h3><p>在官网的 <a href="https://starcoin.org/zh/developer/rpc/postman_document/" target="_blank" rel="noopener noreferrer">Postman 使用指南<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 页面的最下方右键复制链接，并在 Postman 中添加到 Enviroment 后，就可以在 Postman 中发送请求，完成与合约的交互。详细的设置过程可以参考官网的 Postman 使用指南 页面。<br><img src="/assets/img/下载Enviroment_Json文件.055cc637.png" alt="下载Enviroment_Json文件"></p><h3 id="_3-调用api" tabindex="-1"><a class="header-anchor" href="#_3-调用api" aria-hidden="true">#</a> 3. 调用API</h3><p><img src="/assets/img/Postman设置成功.d246546c.png" alt="Postman设置成功"></p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">最后修改于: </span><span class="meta-item-info">2021/9/17 上午5:36:31</span></div><!----></footer><!----><!--[--><!--[--><div class="my-footer">MIT Licensed | Copyright © 2021-present 不霁何虹</div><!--]--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.fa156efa.js" defer></script><script src="/assets/js/1773.b136e78e.js" defer></script><script src="/assets/js/app.7a04ff8e.js" defer></script>
  </body>
</html>
